# Advanced Conditional Logic: Data Model

This document outlines the data model for implementing conditional logic where a control's properties (like visibility, requirement, or enabled state) can be dynamically changed based on the value or state of other controls in the questionnaire.

## Core Component: `Dependency`

A `Dependency` object is added to the `dependencies` array (a new property on the `Control` interface) of a control (let's call this the "dependent control"). This object defines a rule that makes one of its properties (`visible`, `enabled`, `required`) change based on the state of another control (the "target control").

**`Dependency` Interface (as defined in `src/types/index.ts`):**

```typescript
export interface Dependency {
  id: string; // Unique ID for this dependency rule (e.g., generated by nanoid)
  targetControlId: string; // ID of the control whose state/value triggers the condition
  property: "visible" | "enabled" | "required"; // Property of the dependent control that is affected
  condition: DependencyCondition; // The condition to evaluate against the target control
}
```

**`DependencyCondition` Interface (as defined in `src/types/index.ts`):**

```typescript
export interface DependencyCondition {
  type: DependencyConditionType; // The type of comparison to perform
  value: string[]; // Values used for comparison. Usage depends on the 'type'.
                   // For numeric comparisons, strings will be parsed to numbers.
                   // For boolean comparisons (e.g., against a Checkbox), "true" or "false" strings.
}
```

**`DependencyConditionType` Enum (to be added or confirmed in `src/types/index.ts` or a shared location like `LogicEngine.ts`):**

```typescript
export enum DependencyConditionType {
  // Value-based comparisons
  EQUALS = "equals",                 // Target's value equals value[0]
  NOT_EQUALS = "notEquals",           // Target's value does not equal value[0]
  CONTAINS = "contains",             // Target's string value contains value[0] (for text, or selected value in dropdown)
  NOT_CONTAINS = "notContains",       // Target's string value does not contain value[0]
  GREATER_THAN = "greaterThan",       // Target's numeric value > value[0]
  LESS_THAN = "lessThan",             // Target's numeric value < value[0]
  BETWEEN = "between",               // Target's numeric value is between value[0] and value[1] (inclusive)

  // State-based comparisons (value[] is typically ignored by the logic engine for these)
  CHECKED = "checked",               // Target (e.g., Checkbox, ToggleSlider) is checked/true
  UNCHECKED = "unchecked",             // Target is unchecked/false
  FILLED = "filled",                 // Target (e.g., TextBox, Numeric) has a non-empty value
  EMPTY = "empty"                    // Target has an empty/default value
}
```
*(Note: The `DependencyConditionType` enum was also included in the initial scaffold of `LogicEngine.ts`)*

## Notes on `DependencyCondition.value` and `type` Usage:

The `LogicEngine` will interpret the `value` array based on the `type`:

*   **`EQUALS`, `NOT_EQUALS`**:
    *   `value[0]` is the string to compare against.
    *   If `targetControlId` refers to a control with a boolean state (e.g., Checkbox, ToggleSlider), its state (`true`/`false`) will be converted to a lowercase string (`"true"`/`"false"`) by the `LogicEngine` before comparison with `value[0]` (which should also be compared case-insensitively, e.g., by converting to lowercase).
    *   For other controls, their current value will be converted to a string for comparison.
*   **`CONTAINS`, `NOT_CONTAINS`**:
    *   `value[0]` is the substring to check for.
    *   Applies to string values. The `LogicEngine` will convert the target control's value to a lowercase string and `value[0]` to lowercase for case-insensitive comparison.
*   **`GREATER_THAN`, `LESS_THAN`**:
    *   `value[0]` is converted to a number by the `LogicEngine`.
    *   The target control's value is also converted to a number by the `LogicEngine`.
*   **`BETWEEN`**:
    *   `value[0]` (min) and `value[1]` (max) are converted to numbers by the `LogicEngine`.
    *   The target control's value is also converted to a number by the `LogicEngine`.
*   **`CHECKED`, `UNCHECKED`**:
    *   The `value` array is ignored by the `LogicEngine`.
    *   These types directly check the boolean state of the target control (e.g., `true` for `CHECKED`, `false` for `UNCHECKED`).
*   **`FILLED`, `EMPTY`**:
    *   The `value` array is ignored by the `LogicEngine`.
    *   `FILLED` means the target control's value is not undefined, null, and not an empty string after trimming.
    *   `EMPTY` means the target control's value is undefined, null, or an empty string after trimming.

## Retrieving Target Control Value for Evaluation:

The `LogicEngine` (specifically its `getControlValue` helper function) will be responsible for obtaining the relevant "value" from the `targetControlId` based on its `ControlType`. Examples:

*   `ControlType.TextBox`: Current text content (`string`).
*   `ControlType.Checkbox`: Checked state (`boolean`).
*   `ControlType.RadioButton`: (Assuming `targetControlId` is a specific radio button within a group) Checked state (`boolean`).
*   `ControlType.ToggleSlider`: On/off state (`boolean`).
*   `ControlType.Numeric`: Current numeric value (`number`).
*   `ControlType.Dropdown`: Selected value (`string` for single-select. For multi-select, this data model primarily supports conditions like `CONTAINS` checking against the array of selected strings, or specific logic might be needed if checking for exact array equality).

This data model is intended to be stored within the `Questionnaire` JSON structure, specifically by adding a `dependencies: Dependency[]` array to the `Control` interface. The `DependencyConditionType` enum will reside in `src/utils/LogicEngine.ts` and might also be mirrored or imported into `src/types/index.ts` if needed for wider type safety.
